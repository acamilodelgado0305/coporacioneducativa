<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-IA" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      Evaluaci√≥n - Certificado de Manipulaci√≥n de Alimentos | CertiTec Colombia
    </title>
    <link rel="icon" href="logopagina.png" type="image/png" />
    <meta
      name="description"
      content="Presenta la evaluaci√≥n en l√≠nea para obtener tu Certificado de Manipulaci√≥n de Alimentos."
    />

    <link rel="preconnect" href="httpshttps://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      :root {
        --primary: #002e7d;
        --secondary: #10b981;
      }
      body {
        font-family: Poppins, ui-sans-serif, system-ui;
        background: #f1f5f9;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 1rem;
      }
      .text-primary {
        color: var(--primary);
      }
      .bg-primary {
        background: var(--primary);
      }
      .btn-main {
        background: var(--secondary);
        color: #fff;
        font-weight: 700;
        padding: 0.9rem 1.25rem;
        border-radius: 0.75rem;
        transition: 0.2s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
      }
      .btn-main:hover {
        filter: brightness(0.95);
        transform: translateY(-1px);
      }
      .btn-ghost {
        background: #fff;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 0.85rem 1.2rem;
        font-weight: 600;
        width: 100%;
        text-align: center;
        justify-content: center;
      }
      .shadow-soft {
        box-shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
      }
      .step-circle {
        background: var(--secondary);
        color: #fff;
        width: 2rem;
        height: 2rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 9999px;
        font-weight: 800;
        margin-right: 0.5rem;
        flex-shrink: 0;
      }
    </style>

    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "httpshttps://connect.facebook.net/en_US/fbevents.js"
      );
      fbq("init", "639715789143642");
      fbq("track", "PageView");
    </script>
  </head>
  <body>
    <main class="bg-white w-full max-w-2xl rounded-2xl p-6 md:p-8 shadow-soft">
      <div id="quiz-section">
        <div class="text-center mb-6">
          <a href="#" class="font-extrabold text-xl md:text-2xl text-primary"
            >CertiTec Colombia</a
          >
          <h2 class="text-2xl md:text-3xl font-extrabold text-primary mt-4">
            Evaluaci√≥n de Manipulaci√≥n de Alimentos
          </h2>
        </div>
        <div id="quiz-content" class="w-full"></div>
      </div>

      <div id="certificate-section" class="hidden">
        <div id="modal-step-1">
          <div class="text-center">
            <h3 class="text-2xl md:text-3xl font-extrabold text-primary">
              ¬°Aprobaste! üéâ
            </h3>
            <p class="text-slate-600 mt-1" id="final-score-text"></p>
          </div>

          <div class="grid sm:grid-cols-2 gap-4 my-6">
            <figure class="bg-white rounded-xl shadow p-3 border">
              <img
                src="../preview_certificado.png.png"
                alt="Vista previa Carnet de Manipulaci√≥n de Alimentos"
                class="rounded-lg w-full h-auto"
                loading="lazy"
              />
              <figcaption class="text-sm text-slate-600 mt-2 text-center">
                Ejemplo de Carnet
              </figcaption>
            </figure>

            <figure class="bg-white rounded-xl shadow p-3 border">
              <img
                src="../preview_carnet.png.png"
                alt="Vista previa Certificado de Manipulaci√≥n de Alimentos"
                class="rounded-lg w-full h-auto"
                loading="lazy"
              />
              <figcaption class="text-sm text-slate-600 mt-2 text-center">
                Ejemplo de Certificado
              </figcaption>
            </figure>
          </div>
          <div class="mt-6">
            <h4 class="font-bold text-xl text-primary flex items-center mb-3">
              <span class="step-circle">1</span>Completa tus datos
            </h4>
            <div class="space-y-4">
              <div>
                <label class="block font-semibold">Nombre completo</label>
                <input
                  id="fullName"
                  class="w-full border border-gray-300 rounded-lg p-2"
                  placeholder="Tal como aparecer√° en el certificado"
                />
              </div>
              <div class="grid grid-cols-3 gap-2">
                <div>
                  <label class="block font-semibold">Tipo</label>
                  <select
                    id="documentType"
                    class="w-full border border-gray-300 rounded-lg p-2"
                  >
                    <option value="CC">C.C.</option>
                    <option value="CE">C.E.</option>
                    <option value="Pasaporte">Pasaporte</option>
                    <option value="PPT">PPT</option>
                  </select>
                </div>
                <div class="col-span-2">
                  <label class="block font-semibold">Documento</label>
                  <input
                    id="documentId"
                    class="w-full border border-gray-300 rounded-lg p-2"
                    placeholder="N√∫mero"
                  />
                </div>
              </div>
              <div>
                <label class="block font-semibold">Correo electr√≥nico</label>
                <input
                  id="email"
                  type="email"
                  class="w-full border border-gray-300 rounded-lg p-2"
                  placeholder="Para enviar copia del certificado"
                />
              </div>
            </div>
            <button id="go-to-step-2-btn" class="btn-main mt-6">
              Siguiente: elegir pago ‚Üí
            </button>
          </div>
        </div>

        <div id="modal-step-2" class="hidden">
          <div class="text-center">
            <h3 class="text-2xl md:text-3xl font-extrabold text-primary">
              Realiza el pago
            </h3>
            <p class="text-slate-600 mt-1">
              Monto: <strong>$20.000 COP</strong>
            </p>
          </div>
          <div class="mt-6 space-y-5">
            <h4 class="font-bold text-xl text-primary flex items-center mb-2">
              <span class="step-circle">2</span>Elige tu m√©todo
            </h4>
            <a
              href="https://linkdepagospse.rappipay.co/kZYKi5"
              target="_blank"
              class="w-full flex items-center justify-center gap-3 bg-white border-2 border-gray-300 text-gray-800 font-bold py-3 px-4 rounded-lg hover:border-blue-700 transition-all text-lg"
            >
              <img
                src="https://microempresas.co/wp-content/uploads/2024/12/pse-logo-big.webp"
                alt="Logo PSE"
                class="h-8"
                loading="lazy"
              />
              <span
                >Pagar con PSE
                <span class="text-xs font-normal">(recomendado)</span></span
              >
            </a>

            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
              <h5 class="font-bold text-lg text-primary text-center mb-3">
                Transferencia
              </h5>
              <ul class="text-slate-700 space-y-2">
                <li class="flex justify-between">
                  <span>‚úÖ Daviplata:</span
                  ><strong class="font-mono">3223267797</strong>
                </li>
                <li class="flex justify-between">
                  <span>‚úÖ Nequi:</span
                  ><strong class="font-mono">3223267797</strong>
                </li>
                <li class="flex justify-between">
                  <span>‚úÖ Bancolombia Ahorros:</span
                  ><strong class="font-mono">816-589697-49</strong>
                </li>
              </ul>
              <p class="text-xs text-slate-500 mt-3">
                Validaci√≥n manual (puede tardar unas horas).
              </p>
            </div>
          </div>
          <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <button id="go-to-step-3-btn" class="btn-main w-full">
              Ya pagu√©, continuar ‚Üí
            </button>
            <button id="go-to-step-1-btn" class="btn-ghost w-full">
              ‚Üê Corregir mis datos
            </button>
          </div>
        </div>

        <div id="modal-step-3" class="hidden">
          <div class="text-center">
            <h3 class="text-2xl md:text-3xl font-extrabold text-primary">
              √öltimo paso
            </h3>
            <p class="text-slate-600 mt-1">
              Env√≠anos el comprobante para validar tu certificado.
            </p>
          </div>
          <div class="mt-6 space-y-5">
            <h4 class="font-bold text-xl text-primary flex items-center">
              <span class="step-circle">3</span>Enviar comprobante
            </h4>
            <p class="text-slate-600 text-sm">
              Puedes subir el comprobante aqu√≠, o enviarlo por WhatsApp (bot√≥n
              verde).
            </p>
            <input
              type="file"
              id="receiptFile"
              accept="image/*,application/pdf"
              class="w-full border border-gray-300 rounded-lg p-2"
            />
            <button id="upload-receipt-btn" class="btn-ghost w-full">
              Subir comprobante
            </button>
            <button
              id="generate-whatsapp-btn"
              class="w-full bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg py-3 btn-main"
            >
              Enviar por WhatsApp
            </button>

            <div class="border-t pt-5">
              <h4 class="font-bold text-xl text-primary flex items-center mb-2">
                <span class="step-circle">4</span>Verifica y descarga
              </h4>
              <p class="text-slate-600 text-sm mb-3">
                Cuando validemos tu pago, podr√°s ver tu certificado aqu√≠:
              </p>
              <a
                href="https://quickcontrola.com/verificacion"
                target="_blank"
                class="btn-main w-full"
                >Verificar mi certificado</a
              >
            </div>
          </div>
          <div class="text-center mt-6">
            <button id="go-to-step-2-btn-back" class="btn-ghost w-full">
              ‚Üê Volver a m√©todos de pago
            </button>
          </div>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const quizContent = document.getElementById("quiz-content");

        // Contenedores principales
        const quizSection = document.getElementById("quiz-section");
        const certificateSection = document.getElementById(
          "certificate-section"
        );

        // Pasos del formulario de certificado
        const modal1 = document.getElementById("modal-step-1");
        const modal2 = document.getElementById("modal-step-2");
        const modal3 = document.getElementById("modal-step-3");

        // Botones de navegaci√≥n entre pasos
        const goToStep1Btn = document.getElementById("go-to-step-1-btn");
        const goToStep2Btn = document.getElementById("go-to-step-2-btn");
        const goToStep2BtnBack = document.getElementById(
          "go-to-step-2-btn-back"
        );
        const goToStep3Btn = document.getElementById("go-to-step-3-btn");

        // Campos de datos
        const fullName = document.getElementById("fullName");
        const documentType = document.getElementById("documentType");
        const documentId = document.getElementById("documentId");
        const email = document.getElementById("email");

        // Campos de comprobante
        const receiptInput = document.getElementById("receiptFile");
        const uploadReceiptBtn = document.getElementById("upload-receipt-btn");

        const questions = [
          {
            q: "La Resoluci√≥n que rige la manipulaci√≥n de alimentos en Colombia es:",
            opt: ["1080 de 1992", "2674 de 2013", "780 de 2016"],
            a: 1,
          },
          {
            q: "¬øC√≥mo evitas mejor la contaminaci√≥n cruzada?",
            opt: [
              "Lavar con vinagre",
              "Tablas separadas para crudos y cocidos",
              "Cocinar a fuego alto",
            ],
            a: 1,
          },
          {
            q: "La 'Zona de Peligro' de temperatura es:",
            opt: ["0¬∞C a 10¬∞C", "-5¬∞C a 5¬∞C", "5¬∞C a 60¬∞C"],
            a: 2,
          },
          {
            q: "¬øCu√°nto dura el lavado de manos?",
            opt: ["5 s", "10 s", "20 s"],
            a: 2,
          },
          {
            q: "Para desinfectar superficies, es com√∫n usar:",
            opt: ["Agua caliente", "Hipoclorito + agua", "Jugo de lim√≥n"],
            a: 1,
          },
          {
            q: "¬øD√≥nde almacenar carnes crudas en refrigerador?",
            opt: [
              "Parte superior",
              "Con verduras",
              "Parte inferior en recipientes",
            ],
            a: 2,
          },
          {
            q: "La cocci√≥n completa elimina:",
            opt: ["Nutrientes", "Microorganismos peligrosos", "Sabor"],
            a: 1,
          },
          {
            q: "No dejar alimentos cocidos a temperatura ambiente m√°s de:",
            opt: ["8 h", "4 h", "2 h"],
            a: 2,
          },
        ];
        const pass = 0.75;
        let i = 0,
          score = 0;

        function startOver() {
          fbq("track", "StartQuiz");
          i = 0;
          score = 0;
          renderQ();
        }

        function renderQ() {
          const x = questions[i];
          quizContent.innerHTML = `<div class='text-sm font-semibold text-slate-500 mb-2'>Pregunta ${
            i + 1
          } de ${questions.length}</div>
        <h3 class='text-2xl font-bold text-primary mb-4'>${x.q}</h3>
        <div class='space-y-3'>${x.opt
          .map(
            (o, idx) =>
              `<button class='w-full text-left p-4 border-2 border-gray-200 rounded-lg option' data-i='${idx}'>${o}</button>`
          )
          .join("")}</div>
        <div class='flex justify-end mt-4'><button class='btn-main !w-auto' id='next' disabled>Siguiente ‚Üí</button></div>`;
          quizContent
            .querySelectorAll(".option")
            .forEach((b) => b.addEventListener("click", onSelect));
          quizContent.querySelector("#next").addEventListener("click", onNext);
        }

        function onSelect(e) {
          const sel = +e.currentTarget.dataset.i;
          const correct = questions[i].a;
          quizContent
            .querySelectorAll(".option")
            .forEach((b) => (b.disabled = true));
          if (sel === correct) {
            score++;
            e.currentTarget.classList.add("border-green-500", "bg-green-50");
          } else {
            e.currentTarget.classList.add("border-red-500", "bg-red-50");
            quizContent
              .querySelector(`.option[data-i='${correct}']`)
              .classList.add("border-green-500", "bg-green-50");
          }
          quizContent.querySelector("#next").disabled = false;
        }

        function onNext() {
          i++;
          i < questions.length ? renderQ() : showResult();
        }

        function showResult() {
          const pct = score / questions.length;
          const text = document.getElementById("final-score-text");
          if (pct >= pass) {
            text.textContent = `Tu puntaje: ${score}/${
              questions.length
            } (${Math.round(pct * 100)}%).`;

            // Oculta la secci√≥n del quiz y muestra la de certificado
            quizSection.classList.add("hidden");
            certificateSection.classList.remove("hidden");
            showStep(1);
          } else {
            // Se queda en la secci√≥n del quiz, pero muestra el resultado
            quizContent.innerHTML = `<h3 class='text-2xl font-bold text-primary mb-2 text-center'>Examen no superado</h3><p class='text-center text-slate-700 mb-4'>Obtuviste ${score}/${
              questions.length
            } (${Math.round(
              pct * 100
            )}%). Necesitas 75%.</p><div class='text-center'><button class='btn-main' id='retry'>Reintentar</button></div>`;
            quizContent
              .querySelector("#retry")
              .addEventListener("click", startOver);
          }
        }

        function showStep(n) {
          [modal1, modal2, modal3].forEach((m) => m.classList.add("hidden"));
          if (n === 1) modal1.classList.remove("hidden");
          if (n === 2) {
            modal2.classList.remove("hidden");
            fbq("track", "AddPaymentInfo");
          }
          if (n === 3) modal3.classList.remove("hidden");
        }

        // Navegaci√≥n de pasos
        goToStep2Btn.addEventListener("click", () => {
          if (!fullName.value.trim() || !documentId.value.trim()) {
            alert("Por favor, completa nombre y documento.");
            return;
          }
          showStep(2);
        });
        goToStep1Btn.addEventListener("click", () => showStep(1));
        goToStep3Btn.addEventListener("click", () => showStep(3));
        goToStep2BtnBack.addEventListener("click", () => showStep(2));

        // Upload comprobante (placeholder sin backend)
        uploadReceiptBtn.addEventListener("click", () => {
          if (!receiptInput.files.length) {
            alert("Adjunta un archivo de comprobante.");
            return;
          }
          alert(
            "Comprobante adjuntado localmente. (Integrar backend para guardarlo)."
          );
        });

        // WhatsApp con datos + evento Lead
        document
          .getElementById("generate-whatsapp-btn")
          .addEventListener("click", () => {
            if (!fullName.value.trim() || !documentId.value.trim()) {
              alert("Faltan datos. Regresa y compl√©talos.");
              return;
            }
            fbq("track", "Lead");
            const msg = `¬°Hola! He completado el curso y adjunto el comprobante para mi certificado.\n\n*Nombre:* ${fullName.value.trim()}\n*Documento:* ${
              documentType.value
            } ${documentId.value.trim()}${
              email.value ? `\n*Email:* ${email.value.trim()}` : ""
            }`;
            const url = `https://wa.me/573107941580?text=${encodeURIComponent(
              msg
            )}`;
            window.open(url, "_blank");
          });

        renderQ();
      });
    </script>
  </body>
</html>
